<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <!-- Imprescindible en iOS: evita zoom raro al pulsar -->
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Ahora Caigo</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{ --bg:#0b1020; --card:#0f1724; --accent:#ffcc00; --muted:#9aa4b2; }
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#071028 0%, #041228 100%);
      font-family: 'Poppins', sans-serif;
      color:#e6eef8
    }
    .wrap{max-width:900px;margin:28px auto;padding:20px}

    header{display:flex;align-items:center;gap:16px}
    header h1{margin:0;font-size:20px;letter-spacing:1px}
    .panel{background:rgba(255,255,255,0.03);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    .stage{display:grid;grid-template-columns:320px 2fr;gap:18px;margin-top:18px}

    /* Zona del tablero */
    .board{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:18px;border-radius:10px;min-height:320px}
    .question{font-size:18px;margin-bottom:12px}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .choice{
      background:rgba(255,255,255,0.02);
      padding:16px;                 /* más grande para dedos */
      font-size:16px;               /* evita zoom en iOS */
      border-radius:8px;
      border:1px solid transparent;
      cursor:pointer;
      transition:all .18s;
      user-select:none
    }
    .choice:hover{transform:translateY(-3px);border-color:rgba(255,255,255,0.06)}
    .choice:active{background:rgba(255,255,255,0.08);transform:scale(0.98)} /* efecto toque */
    .choice.correct{background:linear-gradient(90deg, rgba(0,120,0,0.25), rgba(0,160,0,0.12));border-color:#0fdb7a}
    .choice.wrong{background:linear-gradient(90deg, rgba(160,0,0,0.12), rgba(120,0,0,0.08));border-color:#ff6b6b}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:14px;color:var(--muted);font-size:14px}

    /* Zona lateral */
    .side{display:flex;flex-direction:column;gap:14px}
    .score{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .score .big{font-size:28px;font-weight:700;color:var(--accent)}

    /* Simulación de trampilla */
    .well{position:relative;background:linear-gradient(180deg,#0b1220,#061226);height:340px;border-radius:8px;padding:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .column{position:absolute;left:50%;top:12px;transform:translateX(-50%);width:220px;height:260px}
    .panel-tiles{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .tile{height:36px;background:rgba(255,255,255,0.03);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#dbe9ff}

    .trapdoor{position:absolute;left:50%;transform:translateX(-50%);bottom:8px;width:80%;height:20px;background:rgba(255,255,255,0.06);border-radius:6px;border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center}
    .trapdoor.open{transform:translateX(-50%) translateY(8px) rotateX(65deg);opacity:0}

    .player {position:absolute;left:50%;transform:translateX(-50%);bottom:56px;width:150px;height:auto;display:flex;align-items:flex-end;justify-content:center;background:transparent;}

    .player img {max-width:50%;max-height:50%;object-fit:contain;pointer-events:none;}

    /* Animación de caída aplicada al contenedor completo */
    .player.fall {animation:fall 1s ease-in forwards;}
    @keyframes fall{to{transform:translateX(-50%) translateY(420px) rotate(20deg);opacity:0}}

    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{
      background:var(--accent);
      border:none;
      color:#061127;
      padding:12px 14px;           
      font-size:16px;               
      border-radius:8px;
      cursor:pointer;
      font-weight:700
    }
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    /* Responsiveness */
    @media (max-width:880px){
      .stage{grid-template-columns:1fr;}
      .column{width:160px}
      .player{width:90px}
    }
  </style>
</head>
<body>
<div class="wrap">
    <header>
        <h1 class="panel">Ahora Caigo - Edición Pela</h1>
    </header>

    <div class="stage">
        <div class="side">
            <div class="panel well" id="well">
                <div class="column" id="column">
                    <div class="panel-tiles" id="tiles"></div>
                </div>
                <div class="player" id="player">
                    <img src="AVATAR.png" alt="Jugador" />
                </div>
                <div class="trapdoor" id="trapdoor">TRAP</div>
            </div>
        </div>
        <div class="board panel">
            
            <div class="question" id="question">Cargando preguntas...</div>
            <div class="choices" id="choices"></div>

        <div class="bottom-panel" style="display:flex; justify-content:space-between; align-items:flex-end; margin-top:auto; flex-wrap:wrap; padding:10px 0;">

        <!-- Información a la derecha, en una sola línea -->
        <div class="info" style="display:flex; gap:25px; text-align:right; flex-wrap:wrap;">
            <div>Vidas: <span id="lives">3</span></div>
            <div>Puntos: <span id="score">0</span></div>
            <div>Ronda: <span id="round">1</span></div>
            <div>Pregunta: <span id="qnum">0</span>/<span id="qtotal">0</span></div>
        </div>

        <div class="controls" style="display:flex; gap:15px; flex-wrap:wrap; flex-direction:row; margin-top:10px;">
            <button id="nextBtn" class="secondary">Siguiente</button>
            <button id="restart">Reiniciar</button>
        </div>
        </div>

    </div>
</div>
</div>

  <script>
    const QUESTIONS = [
        { q: '¿Cuál es su comida favorita?', choices: ['Pizza', 'Espinacas', 'Judías', 'Ensalada'], answer: 0 },
        { q: '¿Cuál es su color favorito?', choices: ['Amarillo', 'Rojo', 'Verde', 'Azul'], answer: 3 },
        { q: '¿Cuál es su serie favorita?', choices: ['Breaking Bad', 'Ataque a los Titanes', 'La Casa de Papel', 'Stranger Things'], answer: 1 },
        { q: '¿Cuál es su animal favorito?', choices: ['Perro', 'Gato', 'Beluga', 'Paloma'], answer: 2 },
        { q: '¿En qué ciudad nació Pela?', choices: ['Sada', 'A Coruña', 'Santiago', 'Pontevedra'], answer: 1 },
        { q: '¿Cuál es su película favorita?', choices: ['Infinity War', 'Titanic', 'Avatar', 'El Padrino'], answer: 0 },
        { q: '¿Qué le gusta hacer en su tiempo libre?', choices: ['Videojuegos', 'Cocinar', 'Leer', 'Dibujar'], answer: 0 },
        { q: '¿Cuál es su videojuego favorito?', choices: ['The Legend of Zelda', 'Super Mario Bros.', 'Minecraft', 'Fortnite'], answer: 2 },
        { q: '¿Cuál es su género musical favorito?', choices: ['Pop-Rock', 'Reggeton', 'Jazz', 'Clásica'], answer: 0 },
        { q: '¿Cuál es su lugar de vacaciones ideal?', choices: ['Playa', 'Montaña', 'Ciudad', 'Campo'], answer: 2 },
        { q: '¿Qué le gusta más hacer los fines de semana?', choices: ['Salir con amigos', 'Quedar con Car', 'Ir al cine', 'Hacer deporte'], answer: 1 },
        { q: '¿Cuál es su estación del año favorita?', choices: ['Primavera', 'Verano', 'Otoño', 'Invierno'], answer: 3 },
        { q: '¿Qué instrumento musical le gustaría tocar?', choices: ['Flauta', 'Piano', 'Batería', 'Violín'], answer: 2 },
        { q: '¿Cuál es su deporte favorito para ver?', choices: ['Fútbol', 'Baloncesto', 'Tenis', 'Ninguno'], answer: 3 },
        { q: '¿Cuál es su postre favorito?', choices: ['Yogur', 'Tarta de queso', 'Brownie', 'Fruta'], answer: 1 },
    ];

    const QUESTIONS_PER_ROUND = 5;

    // Estado del juego
    let round = 1;
    let idx = 0;
    let score = 0;
    let lives = 3;
    let locked = false;

    // Elementos del DOM
    const elQuestion = document.getElementById('question');
    const elChoices = document.getElementById('choices');
    const elQnum = document.getElementById('qnum');
    const elQtotal = document.getElementById('qtotal');
    const elLives = document.getElementById('lives');
    const elScore = document.getElementById('score');
    const elRound = document.getElementById('round');
    const elNext = document.getElementById('nextBtn');
    const elRestart = document.getElementById('restart');
    const elTiles = document.getElementById('tiles');
    const elPlayer = document.getElementById('player');
    const elTrapdoor = document.getElementById('trapdoor');

    // Inicializar juego
    function init() {
        idx = 0;
        score = 0;
        lives = 3;
        round = 1;
        locked = false;
        elQtotal.textContent = QUESTIONS_PER_ROUND;
        renderTiles();
        render();
    }

    // Obtener preguntas de la ronda actual (en orden)
    function getRoundQuestions() {
        const start = (round - 1) * QUESTIONS_PER_ROUND;
        return QUESTIONS.slice(start, start + QUESTIONS_PER_ROUND);
    }

    // Renderizar tiles
    function renderTiles() {
        elTiles.innerHTML = '';
        const roundQs = getRoundQuestions();
        for(let i = 0; i < roundQs.length; i++) {
            const d = document.createElement('div'); 
            d.className = 'tile'; 
            d.textContent = i+1; 
            elTiles.appendChild(d);
        }
        highlightTiles();
    }

    // Resaltar tiles ya contestadas
    function highlightTiles() {
        const children = elTiles.children;
        for(let i = 0; i < children.length; i++) {
            children[i].style.opacity = i < idx ? '0.35' : '1';
        }
    }

    // Renderizar pregunta actual
    function render() {
        const current = getRoundQuestions()[idx];
        elQuestion.textContent = current.q;
        elChoices.innerHTML = '';
        current.choices.forEach((c, i) => {
            const btn = document.createElement('div');
            btn.className = 'choice';
            btn.tabIndex = 0;
            btn.dataset.index = i;
            btn.textContent = `${i+1}. ${c}`;
            btn.addEventListener('click', ()=> select(i, btn));
            elChoices.appendChild(btn);
        });
        elQnum.textContent = idx+1;
        elLives.textContent = lives;
        elScore.textContent = score;
        elRound.textContent = round;
        highlightTiles();
        locked = false;
        elNext.disabled = false;
    }

    // Selección de respuesta
    function select(selectedIndex, btnEl) {
        if(locked) return;
        locked = true;
        const current = getRoundQuestions()[idx];
        const correct = current.answer;
        [...elChoices.children].forEach(ch => ch.classList.remove('correct','wrong'));

        if(selectedIndex === correct) {
            btnEl.classList.add('correct');
            score += 10;
            elScore.textContent = score;
            setTimeout(nextQuestion, 700);
        } else {
            btnEl.classList.add('wrong');
            elChoices.children[correct].classList.add('correct');
            lives--;
            elLives.textContent = lives;
            if(lives <= 0) triggerFall();
            else {
                elTrapdoor.classList.add('open');
                setTimeout(()=> elTrapdoor.classList.remove('open'), 800);
                setTimeout(()=> locked=false, 800);
            }
        }
        highlightTiles();
    }

    // Pasar a la siguiente pregunta
    function nextQuestion() {
        const children = elTiles.children;
        if(children[idx]) children[idx].style.background = 'linear-gradient(90deg, rgba(255,204,0,0.15), rgba(255,255,255,0.02))';
        idx++;
        const roundQs = getRoundQuestions();
        if(idx >= roundQs.length) {
            round++;
            idx = 0;
            if((round-1) * QUESTIONS_PER_ROUND >= QUESTIONS.length) {
                showMessage(`¡Has terminado todas las preguntas! Puntuación final: ${score}`);
                return;
            }
            renderTiles();
            showMessage(`¡Has completado la ronda ${round-1}! Comienza la ronda ${round}.`);
        }
        render();
    }

    // Animación caída
    function triggerFall() {
        elTrapdoor.classList.add('open');
        elPlayer.classList.add('fall');
        showMessage('¡Has caido! Juego terminado.');
        locked = true;
        setTimeout(()=> elPlayer.style.display='none', 1200);
    }

    function showMessage(msg) {
        const message = document.createElement('div');
        message.textContent = msg;

        // Estilos
        message.style.position = 'fixed';
        message.style.bottom = '20px';
        message.style.left = '50%';
        message.style.transform = 'translateX(-50%)';
        message.style.background = 'rgba(231, 76, 60, 0.9)';
        message.style.color = '#fff';
        message.style.padding = '10px 20px';
        message.style.borderRadius = '8px';
        message.style.boxShadow = '0 4px 15px rgba(0,0,0,0.4)';
        message.style.fontFamily = 'Poppins, sans-serif';
        message.style.fontWeight = '600';
        message.style.opacity = '0';
        message.style.transition = 'opacity 0.3s';

        // Ancho máximo y ancho relativo para móviles
        message.style.width = '90%';       // ocupa casi todo el ancho en móvil
        message.style.maxWidth = '600px';  // no demasiado ancho en pantallas grandes
        message.style.textAlign = 'center'; // centra el texto

        document.body.appendChild(message);

        // Mostrar con animación
        requestAnimationFrame(() => {
            message.style.opacity = '1';
        });

        // Desaparecer después de 3 segundos
        setTimeout(() => {
            message.style.opacity = '0';
            message.addEventListener('transitionend', () => message.remove());
        }, 3000);
    }


    // Controles
    elNext.addEventListener('click', ()=>{ if(!locked) nextQuestion(); });
    elRestart.addEventListener('click', ()=>{
        elPlayer.style.display=''; 
        elPlayer.classList.remove('fall'); 
        elTrapdoor.classList.remove('open');
        init();
    });

    // Teclado 1-4
    window.addEventListener('keydown', (e)=>{
        if(e.key >= '1' && e.key <= '4'){
            const n = parseInt(e.key)-1;
            const current = getRoundQuestions()[idx];
            if(current && current.choices[n] !== undefined){
                select(n, elChoices.children[n]);
            }
        }
        if(e.key==='Enter') nextQuestion();
        if(e.key==='r' || e.key==='R') elRestart.click();
    });

    // Inicializar
    init();
</script>
</body>
</html>
