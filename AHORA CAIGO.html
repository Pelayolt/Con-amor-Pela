<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <!-- Imprescindible en iOS: evita zoom raro al pulsar -->
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{ --bg:#0b1020; --card:#0f1724; --accent:#ffcc00; --muted:#9aa4b2; }
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#071028 0%, #041228 100%);
      font-family: 'Poppins', sans-serif;
      color:#e6eef8
    }
    .wrap{max-width:900px;margin:28px auto;padding:20px}

    header{display:flex;align-items:center;gap:16px}
    header h1{margin:0;font-size:20px;letter-spacing:1px}
    .panel{background:rgba(255,255,255,0.03);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    .stage{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:18px}

    /* Zona del tablero */
    .board{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:18px;border-radius:10px;min-height:420px}
    .question{font-size:18px;margin-bottom:12px}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .choice{
      background:rgba(255,255,255,0.02);
      padding:16px;                 /* más grande para dedos */
      font-size:16px;               /* evita zoom en iOS */
      border-radius:8px;
      border:1px solid transparent;
      cursor:pointer;
      transition:all .18s;
      user-select:none
    }
    .choice:hover{transform:translateY(-3px);border-color:rgba(255,255,255,0.06)}
    .choice:active{background:rgba(255,255,255,0.08);transform:scale(0.98)} /* efecto toque */
    .choice.correct{background:linear-gradient(90deg, rgba(0,120,0,0.25), rgba(0,160,0,0.12));border-color:#0fdb7a}
    .choice.wrong{background:linear-gradient(90deg, rgba(160,0,0,0.12), rgba(120,0,0,0.08));border-color:#ff6b6b}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:14px;color:var(--muted);font-size:14px}

    /* Zona lateral */
    .side{display:flex;flex-direction:column;gap:14px}
    .score{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .score .big{font-size:28px;font-weight:700;color:var(--accent)}

    /* Simulación de trampilla */
    .well{position:relative;background:linear-gradient(180deg,#0b1220,#061226);height:340px;border-radius:8px;padding:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .column{position:absolute;left:50%;top:12px;transform:translateX(-50%);width:220px;height:260px}
    .panel-tiles{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .tile{height:36px;background:rgba(255,255,255,0.03);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#dbe9ff}

    .trapdoor{position:absolute;left:50%;transform:translateX(-50%);bottom:8px;width:80%;height:38px;background:#071127;border-radius:6px;border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center}
    .trapdoor.open{transform:translateX(-50%) translateY(8px) rotateX(65deg);opacity:0}

    .player {position:absolute;left:50%;transform:translateX(-50%);bottom:56px;width:150px;height:auto;display:flex;align-items:flex-end;justify-content:center;background:transparent;}

    .player img {max-width:100%;max-height:220px;object-fit:contain;pointer-events:none;}

    /* Animación de caída aplicada al contenedor completo */
    .player.fall {animation:fall 1s ease-in forwards;}
    @keyframes fall{to{transform:translateX(-50%) translateY(420px) rotate(20deg);opacity:0}}

    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{
      background:var(--accent);
      border:none;
      color:#061127;
      padding:12px 14px;           
      font-size:16px;               
      border-radius:8px;
      cursor:pointer;
      font-weight:700
    }
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    /* Responsiveness */
    @media (max-width:880px){
      .stage{grid-template-columns:1fr;}
      .column{width:160px}
      .player{width:90px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 class="panel">Ahora Caigo</h1>
    </header>

    <div class="stage">
      <div class="board panel">
        <div class="question" id="question">Cargando preguntas...</div>
        <div class="choices" id="choices"></div>
        <div class="meta">
          <div id="progress">Pregunta <span id="qnum">0</span>/<span id="qtotal">0</span></div>
          <div id="status">Vidas: <span id="lives">3</span></div>
        </div>
        <div style="margin-top:14px;display:flex;justify-content:space-between;align-items:center">
          <div class="controls">
            <button id="nextBtn" class="secondary">Siguiente</button>
            <button id="restart">Reiniciar</button>
          </div>
        </div>
      </div>

      <div class="side">
        <div class="panel score">
          <div>
            <div style="font-size:13px;color:var(--muted)">Puntuación</div>
            <div class="big" id="score">0</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:13px;color:var(--muted)">Ronda</div>
            <div id="round">1</div>
          </div>
        </div>

        <div class="panel well" id="well">
        <div class="column" id="column">
            <div class="panel-tiles" id="tiles"></div>
        </div>
        <div class="player" id="player">
            <img src="https://drive.google.com/uc?export=view&id=1bEbpXWc4YflS4_6cDIpA3t33qLKH8yJP" alt="Jugador" />
        </div>
        <div class="trapdoor" id="trapdoor">TRAP</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const QUESTIONS = [
      { q: '¿Cuál es la capital de España?', choices: ['Barcelona', 'Madrid', 'Valencia', 'Sevilla'], answer: 1 },
      { q: '¿2 + 2 = ?', choices: ['3', '4', '5', '6'], answer: 1 },
      { q: '¿El río más largo del mundo es?', choices: ['Nilo', 'Amazonas', 'Yangtsé', 'Misisipi'], answer: 1 },
      { q: '¿Quién pintó La Gioconda?', choices: ['Vincent van Gogh', 'Leonardo da Vinci', 'Pablo Picasso', 'Claude Monet'], answer: 1 },
    ];

    // Estado del juego
    let idx = 0, score = 0, lives = 3, locked = false, round = 1;

    // Elementos
    const elQuestion = document.getElementById('question');
    const elChoices = document.getElementById('choices');
    const elQnum = document.getElementById('qnum');
    const elQtotal = document.getElementById('qtotal');
    const elLives = document.getElementById('lives');
    const elScore = document.getElementById('score');
    const elRound = document.getElementById('round');
    const elNext = document.getElementById('nextBtn');
    const elRestart = document.getElementById('restart');
    const elTiles = document.getElementById('tiles');
    const elPlayer = document.getElementById('player');
    const elTrapdoor = document.getElementById('trapdoor');

    function init(){
      if(!QUESTIONS || !QUESTIONS.length){
        elQuestion.textContent = 'No hay preguntas. Edita el array QUESTIONS en el script.';
        return;
      }
      idx = 0; score = 0; lives = 3; locked = false; round = 1;
      elQtotal.textContent = QUESTIONS.length;
      renderTiles();
      render();
    }

    function renderTiles(){
      // Visual: una serie de 'baldosas' que representan las preguntas restantes
      elTiles.innerHTML = '';
      for(let i=0;i<QUESTIONS.length;i++){
        const d = document.createElement('div'); d.className = 'tile'; d.textContent = i+1; elTiles.appendChild(d);
      }
      highlightTiles();
    }

    function highlightTiles(){
      const children = elTiles.children;
      for(let i=0;i<children.length;i++){
        children[i].style.opacity = i < idx ? '0.35' : '1';
      }
    }

    function render(){
      const current = QUESTIONS[idx];
      elQuestion.textContent = current.q;
      elChoices.innerHTML = '';
      current.choices.forEach((c,i)=>{
        const btn = document.createElement('div'); btn.className = 'choice'; btn.tabIndex = 0; btn.dataset.index = i; btn.textContent = `${i+1}. ${c}`;
        btn.addEventListener('click', ()=> select(i, btn));
        elChoices.appendChild(btn);
      });
      elQnum.textContent = idx+1;
      elLives.textContent = lives;
      elScore.textContent = score;
      elRound.textContent = round;
      highlightTiles();
      locked = false;
      elNext.disabled = false;
    }

    function select(selectedIndex, btnEl){
      if(locked) return;
      locked = true;
      const correct = QUESTIONS[idx].answer;
      // marcar todas las opciones
      [...elChoices.children].forEach(ch=>ch.classList.remove('correct','wrong'));
      if(selectedIndex === correct){
        btnEl.classList.add('correct');
        score += 10; // puntos por acierto
        elScore.textContent = score;
        // avanzar automáticamente tras pequeño delay
        setTimeout(()=>{
          nextQuestion();
        }, 700);
      } else {
        btnEl.classList.add('wrong');
        // mostrar cuál era la correcta
        elChoices.children[correct].classList.add('correct');
        lives -= 1;
        elLives.textContent = lives;
        // animación de caída si se quedan sin vidas
        if(lives <= 0){
          triggerFall();
        } else {
          // abrir tapa un poco para dramatizar
          elTrapdoor.classList.add('open');
          setTimeout(()=> elTrapdoor.classList.remove('open'), 800);
          // permitir siguiente pregunta
          setTimeout(()=>{ locked=false; }, 800);
        }
      }
      // actualizar tile visual
      highlightTiles();
    }

    function nextQuestion(){
      // marcar la baldosa actual como pasada
      const children = elTiles.children;
      if(children[idx]) children[idx].style.background = 'linear-gradient(90deg, rgba(255,204,0,0.15), rgba(255,255,255,0.02))';
      idx++;
      if(idx >= QUESTIONS.length){
        // fin de ronda
        round++;
        if(lives > 0){
          // si quieres reiniciar preguntas o repetir aleatoriamente, puedes barajar aquí
          idx = 0; renderTiles();
          showMessage(`¡Has completado la ronda ${round-1}! Puntuación: ${score}. Comienza la ronda ${round}.`);
        } else {
          showMessage('Juego terminado — te quedaste sin vidas. Pulsa Reiniciar para jugar de nuevo.');
        }
        render();
        return;
      }
      render();
    }

    function triggerFall(){
      elTrapdoor.classList.add('open');
      elPlayer.classList.add('fall');
      showMessage('¡Has caido! Juego terminado.');
      locked = true;
      // al terminar la animación dejamos el estado final
      setTimeout(()=>{
        // reset visual del jugador tras 1.2s
        elPlayer.style.display = 'none';
      }, 1200);
    }

    function showMessage(msg){
      // Mensaje simple con alert nativo para no incorporar librerías
      setTimeout(()=>alert(msg), 80);
    }

    // Controles
    elNext.addEventListener('click', ()=>{
      if(locked) return; nextQuestion();
    });
    elRestart.addEventListener('click', ()=>{
      // restaurar visual
      elPlayer.style.display = ''; elPlayer.classList.remove('fall'); elTrapdoor.classList.remove('open');
      init();
    });

    // Atajos de teclado 1-4
    window.addEventListener('keydown', (e)=>{
      if(e.key >= '1' && e.key <= '4'){
        const n = parseInt(e.key) - 1;
        const current = QUESTIONS[idx];
        if(current && current.choices[n] !== undefined){
          select(n, elChoices.children[n]);
        }
      }
      if(e.key === 'Enter') nextQuestion();
      if(e.key === 'r' || e.key === 'R') elRestart.click();
    });

    // Inicializar
    init();
  </script>
</body>
</html>
