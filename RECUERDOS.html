<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Coraz칩n 3D ASCII</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Estilos -->
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #000;
      display: flex;
      align-items: center;     /* centra verticalmente */
      justify-content: center; /* centra horizontalmente */
      flex-direction: column;  /* mantiene apilado en columna */
      font-family: 'Poppins', sans-serif;
      color: #ddd;
    }
    #screen {
      color: #e74c3c;
;     white-space: pre;
      line-height: 0.65;
      font-size: 10px;
      letter-spacing: 0;
      text-align: center; /* centra las l칤neas de caracteres */
    }
    #card {
      position: fixed;
      max-width: 300px;
      color: #fff;
      padding: 20px;
      border-radius: 15px;
      font-family: 'Poppins', sans-serif;
      text-align: center;
    }
    #card h2 {
      margin-top: 0;
      color: #e74c3c;
    }
    #card p {
      margin: 10px 0;
      font-size: 14px;
      line-height: 1.4;
    }

  </style>
</head>
<body>
<div id="card">
  <h2>Para mi peque 游눘</h2>
  <p>Recuerdo el d칤a en que nos conocimos en persona, en la biblioteca; yo me hice el guay con mi juguetito friki.</p>  
  <p>Recuerdo nuestro primer beso; los nervios se sent칤an en el ambiente.</p>
  <p>Recuerdo los d칤as de descanso en el coche; no se porque, hacia mucho calor.</p>
  <p>Recuerdo la primera vez que dormimos juntos; a pesar de que la cama era peque침ita, me sent칤 como si te conociera de toda la vida.</p>
  <p>Recuerdo el d칤a que conoc칤 a tu familia; casi me muero de verg칲enza en el ascensor.</p>
  <p>Recuerdo nuestras salidas a comer sushi; tu cara de felicidad era indescriptible y me hac칤a sonre칤r sin raz칩n.</p>
  <p>Recuerdo nuestro primer viaje juntos; los moros abundaban por la zona.</p>
  <p>Y por todos esos recuerdos, por todos los momentos que hemos compartido, es que te quiero con todo mi coraz칩n.</p>

</div>
 
<pre id="screen"></pre>

<script>
(()=>{

const chars = " .:-=+*#%@";     // mapa de brillo (de oscuro a claro)
const screen = document.getElementById('screen');

let W = 80, H = 40;
let running = true;

function F(x,y,z){
  // ecuaci칩n impl칤cita que define la "superficie" del coraz칩n
  const a = x*x + 2.25*y*y + z*z - 1.0;
  return a*a*a - x*x*z*z*z - (9.0/80.0) * y*y * z*z*z;
}

function rotatePoint(p, ax, ay){
  // rota (p) primero alrededor de Y (ay) y luego alrededor de X (ax)
  const cosy = Math.cos(ay), siny = Math.sin(ay);
  const x1 = cosy*p.x + siny*p.z;
  const z1 = -siny*p.x + cosy*p.z;
  const cosx = Math.cos(ax), sinx = Math.sin(ax);
  const y2 = cosx*p.y - sinx*z1;
  const z2 = sinx*p.y + cosx*z1;
  return {x:x1,y:y2,z:z2};
}

function rotateVecInverse(v, ax, ay){
  // convierte un vector gradiente desde coords del objeto a coords "mundo"
  // aplicando Rx^T y Ry^T (rotaciones inversas)
  const cosx = Math.cos(-ax), sinx = Math.sin(-ax);
  const y1 = cosx*v.y - sinx*v.z;
  const z1 = sinx*v.y + cosx*v.z;
  const x1 = v.x;
  const cosy = Math.cos(-ay), siny = Math.sin(-ay);
  const x2 = cosy*x1 + siny*z1;
  const z2 = -siny*x1 + cosy*z1;
  return {x:x2,y:y1,z:z2};
}

function gradientAt(x,y,z){
  const eps = 1e-2;
  const dx = (F(x+eps,y,z) - F(x-eps,y,z)) / (2*eps);
  const dy = (F(x,y+eps,z) - F(x,y-eps,z)) / (2*eps);
  const dz = (F(x,y,z+eps) - F(x,y,z-eps)) / (2*eps);
  return {x:dx,y:dy,z:dz};
}

function normalize(v){
  const L = Math.hypot(v.x,v.y,v.z) || 1e-9;
  return {x:v.x/L,y:v.y/L,z:v.z/L};
}

const lightDir = normalize({x:0.0,y:0.5,z:1.0});

let lastTime = 0;
let angle = 0;

function renderFrame(dt){
  const aspect = W / H;
  const scale = 1.2;
  const xMul = scale * aspect;
  const yMul = scale;

  const zStart = 1.5, zEnd = -1.5;
  const zSteps = 60;
  const dz = (zStart - zEnd) / zSteps;

  let out = '';
  for(let j=0;j<H;j++){
    for(let i=0;i<W;i++){
      const nx = (i / (W-1) * 2 - 1) * xMul;
      const ny = (j / (H-1) * 2 - 1) * yMul;

      let hit = false;
      let prevF = null;
      let prevZ = zStart;
      let hitPosObj = null;

      for(let step=0; step<=zSteps; step++){
        const z = zStart - step * dz;
        const pObj = rotatePoint({x:nx, y:ny, z:z}, angle, angle*0.4);
        const f = F(pObj.x, pObj.y, pObj.z);
        if(step === 0){ prevF = f; prevZ = z; }
        if(Math.abs(f) < 1e-2){
          hit = true;
          hitPosObj = pObj;
          break;
        }
        if(prevF * f < 0){
          const t = prevF / (prevF - f);
          const zRoot = prevZ + t * (z - prevZ);
          hitPosObj = rotatePoint({x:nx,y:ny,z:zRoot}, angle, angle*0.4);
          hit = true;
          break;
        }
        prevF = f;
        prevZ = z;
      }

      if(hit && hitPosObj){
        const g = gradientAt(hitPosObj.x, hitPosObj.y, hitPosObj.z);
        const gw = rotateVecInverse(g, angle, angle*0.4);
        const normal = normalize(gw);
        let intensity = normal.x*lightDir.x + normal.y*lightDir.y + normal.z*lightDir.z;
        intensity = Math.max(0.0, Math.min(1.0, (intensity + 0.1)));
        const idx = Math.floor(intensity * (chars.length - 1));
        out += chars[idx];
      } else {
        out += ' ';
      }
    }
    out += '\n';
  }

  screen.textContent = out;
}

function loop(t){
  if(!running) {
    return;
  }
  const dt = (t - lastTime) / 1000;
  lastTime = t;
  angle += dt * 1.0; // velocidad de rotaci칩n
  renderFrame(dt);
  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);

})();
</script>
</body>
</html>